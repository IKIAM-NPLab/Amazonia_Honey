---
title: "HS_GCMS_Spectral_Deconvolution"
author: "Angiely Camacho, Jefferson Pastuna"
date: "2024-04-12"
output:
  github_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
usethis::git_vaccinate()

```

### Introduction

Write an Introduction.

### Before to start

Write a package description.

### eRah package workflow

How to star.

```{r echo=TRUE, message=FALSE}

# eRah package installation
#install.packages('erah')
# eRah library call
library(erah)

```

Folder files

```{r echo=TRUE}

createdt('E:/Tesis_Mieles/Amazonia_Honey/Data/HS_GCMS_Data_to_eRah/')

```

New experiment.


```{r echo=TRUE}

instrumental <- read.csv('E:/Tesis_Mieles/Amazonia_Honey/Data/HS_GCMS_Metadata_to_eRah/HS_GCMS_Data_inst.csv')
phenotype <- read.csv('E:/Tesis_Mieles/Amazonia_Honey/Data/HS_GCMS_Metadata_to_eRah/HS_GCMS_Data_pheno.csv')

ex <- newExp(instrumental = instrumental,
             phenotype = phenotype,
             info = 'Amazonia honey')

```

Compound deconvolution

Parameter

```{r echo=TRUE}

ex.dec.par <- setDecPar(min.peak.width = 2,
                        min.peak.height = 450,
                        noise.threshold = 45,
                        avoid.processing.mz = c(30:69,73:75,147:149))

```

parallel processing

```{r echo=TRUE}

plan(future::multisession,workers = 16)

```

Deconvolution

```{r echo=TRUE}

ex <- deconvolveComp(ex, ex.dec.par)

```

Alignment

```{r echo=TRUE}
# Alignment parameter
ex.al.par <- setAlPar(min.spectra.cor = 0.90, max.time.dist = 3, mz.range = 70:550)
# Alignment
ex <- alignComp(ex, alParameters = ex.al.par)

```

Missing compound recovery


```{r echo=TRUE}

ex <- recMissComp(ex, min.samples = 3)

```

Identification

```{r echo=TRUE}

# Identification
ex <- identifyComp(ex)
# Identified compound
id.list <- idList(ex)
head(id.list[,1:4], n = 8)

```

Peak compound view

```{r echo=TRUE}

plotProfile(ex, 94)

```

Mirror plot of identified compounds

```{r echo=TRUE}

#plotSpectra(ex, 19, 2, draw.color = "orange")

```

Exporting spectra to NIST

```{r echo=TRUE}

export2MSP(ex,
           store.path = "E:/Tesis_Mieles/Amazonia_Honey/Result/eRah_Result",
           alg.version = 2)

```



